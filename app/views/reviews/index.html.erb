<p id="notice"><%= notice %></p>

<h1><%= t('reviews.title') %></h1>

<table>
  <thead>
    <tr>
      
      <th>Title</th>
      <th>Category</th>
      <th>Rich_Description</th>
      <th>Authors grade</th> 
      <th>Average raiting</th> 

      <th colspan="3"></th>
    </tr>
  </thead>
  <div><%= current_user ? current_user.id : 'no user'%></div>
  <tbody>
    <% @reviews.each do |review| %>
    <tr>
      <td><%= review.title %></td>
      <td><%= review.category %></td>
      <td><%= review.rich_description %></td>        
      <td><%= review.authors_grade %></td> 
      <td><% rating = review.find_votes_for(vote_scope: 'rank').sum(:vote_weight).to_f  %>
        <% total = review.find_votes_for(vote_scope: 'rank').size.to_f %>
        <%= total== 0 ? "no raties" : (rating / total).round(1) %>
      </td> 
      <% if current_user.try(:admin?) %>
      <td><%= link_to 'Show', review %></td>
      <td><%= link_to 'Edit', edit_review_path(review) %></td>
      <td><%= link_to 'Destroy', review, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <% end %>
      <td><%= link_to " favorite ",   favorited_path(review) %></td>
      <td><%= link_to " unfavorite ",   unfavorited_path(review) %></td>
      <td><%= link_to "1", vote_path(review,:score => 1) %></td>
      <td><%= link_to "2", vote_path(review,:score => 2) %></td>
      <td><%= link_to "3", vote_path(review,:score => 3) %></td>
      <td><%= link_to "4", vote_path(review,:score => 4) %></td>
      <td><%= link_to "5", vote_path(review,:score => 5) %></td>

    </tr>
    <%end%>

  </tbody>
</table>
<% if current_user != nil  %>
<% current_user.favorites.all.each do |review| %>
<tr>
  <td><%= review.title %></td>
</tr>
<br>
<% end %>
<%=  current_user.admin? ? 'admin' : 'not admin' %>

<%end%>
<%= link_to 'New Review', new_review_path %>
